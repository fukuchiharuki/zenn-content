---
title: "ドメイン駆動設計"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [ドメイン駆動設計, DDD]
published: false
---

ドメイン駆動設計に興味を持ったとき、私たちの前にはさまざまな設計パターンに関する情報が現れます。なかでも、「エンティティ」「値オブジェクト」「アグリゲート」「リポジトリ」といったパターンは明快で実装に導入しやすいため、実践する人も多いことでしょう。

かつて私も、軽量DDDのような取り組みに惹かれ、実装の形式を守ることこそが"ドメイン駆動設計だ"と信じていました。しかしいつからか「これが本当に設計なのか？」と疑問をもつようになり、この問いと向き合う中で、設計の対象に対して**明確なメンタルモデルを持つこと**の方が、実はずっと大切なのだと気がつきました。

「私たちは、どのように世界を理解し、どのような物語を編むのか？」

本稿では、ドメイン駆動設計の本質をあらためて見つめ直し、そこから最初の実践へと踏み出す一歩を考えてみたいと思います。

## 誤解を紐解く

### 『エリック・エヴァンスのドメイン駆動設計』はパターン集

ドメイン駆動設計という言葉を聞くとき、私たちはしばしば、設計パターンや設計技法に関する豊富な知識を思い浮かべます。その中には、ソフトウェアの複雑さに立ち向かうための実践的な考え方や手法が数多く含まれています。こうした知識は、ドメイン駆動設計を学び始めた人々にとって大きな魅力であり、しかしまた同時に、少し圧倒されるものでもあります。

実際、『エリック・エヴァンスのドメイン駆動設計』は、数多くのパターンとそれらの関係性を丁寧に書き綴った――まさに「設計とプロセスのパターン集」とも呼べる一冊です。日本語訳の帯には「ユーザ要求の問題解決にフォーカスした設計パターン」と掲げられています。

それではまず、パターンとは何かについて、少し振り返ってみることにしましょう。

### パターンとは

ドメイン駆動設計に対する誤解を紐解いていくために、まずは「パターン」とは何かについて目を向けてみます。

パターンはもともと建築の分野で発展してきたものです^[CreativeShift. “パターン・ランゲージとは”. クリエイティブシフト. 2020-09-05. https://creativeshift.co.jp/pattern-lang/, (参照 2025-05-01).]。特に有名なのは、建築家クリストファー・アレグザンダーが提唱した「パターン・ランゲージ」という考え方です。そこでは、人々の暮らしや営みの中に繰り返し現れる「よいかたち」を見出だし、それを言語（ランゲージ）として共有することで、実践知やセンスを伝えようとしています。

ソフトウェア開発におけるパターンも、同じ発想に立っています。**ある状況において、ある種の問題を、ある種の方法で解決するための知識**がパターンなのです。

パターンの意義を曖昧にすると、私たちは本来の意図とは異なるかたちでドメイン駆動設計を捉えてしまうかもしれません。次に、パターンの誤用について考えてみましょう。

:::message
これに対して、「アーキテクチャ」はどうでしょうか。

アーキテクチャもまた建築由来の言葉ですが、こちらは「全体がどうまとまっているか」に焦点を当てます。対象物を特徴づける様式のことで、材料・方法・フォームを含むスタイルであり、文化・思想・価値観を反映した表現でもあります。

パターンが「個々の局所的な問題の解決」であるのに対して、アーキテクチャは「全体の構造や骨格」あるいはその「文化的背景や思想」を指します。
:::

### スタイルとしての導入

パターン同士には参照や関連が示されることがありますが、特定の順序や一律の重要度が定められているわけではありません。パターンの利用者（読者である私たちです）はそのときの文脈やフォースに応じて、適切なパターンを選び、組み合わせて使うことが求められます。

:::message
ドメイン駆動設計に関する議論を眺めてみると、「イミュータブルな値オブジェクトにしなければならない」「集約はカプセル化されていなければならない」――のように技術的なプラクティスが強調されることが少なくありません。

軽量DDDやボトムアップDDDなど、戦術的設計と総称される設計パターンを重視する傾向が、日本では特に顕著であるように感じます。

英語圏の記事や議論を覗いてみると、「BC」という単語が頻繁に登場することからも、Bonded ContextやContext Mapなどが議論の中心に据えられている印象を受けます。
:::

### ドメイン駆動設計とは

---


1. 『エリック・エヴァンスのドメイン駆動設計』はパターン集
   - 原著が目指したもの
   - モデル駆動設計の重要性
   - なぜパターンに重点が置かれたのか
2. パターンとアーキテクチャの違い
   - グラデーション的な境界
   - 「パターン」は局所的な知恵、「アーキテクチャ」は全体の骨格
   - どう違う意識で扱うべきか
3. 軽量DDDはドメイン駆動設計ではない
   - パターンをなぞるだけではドメイン駆動にならない
   - メンタルモデルなき適用の危うさ
   - 「Lite」という言葉に潜む落とし穴
4. ドメイン駆動設計とは
   - モデルを中心に据える設計
   - ドメインに対する深い愛と理解
   - 設計者とドメインとの「対話」の重み
5. ドメイン駆動設計をLiteに実践する
   - モデル駆動を小さく始める試み
   - すべてを大仰にしない「静かなドメイン理解」
   - 仮説→試行→修正のサイクル
6. 一人で始めるドメイン駆動設計
   - メンタルモデルを持つ勇気
   - 仮説を外に出し、対話を重ねる
   - 一人でも、ドメインを愛する心を育てる

---

ドメイン駆動設計と言えばエンティティパターンやリポジトリパターンを思い浮かべる人も多いことでしょう。
軽量DDDやボトムアップDDDなど、戦術的設計と総称される設計パターンを重視する傾向は日本で独自に育まれてきているように感じます。
英語圏の記事や議論を眺めてみると、「BC」という単語が頻繁に登場することからも、Bonded ContextやContext Mapなどが議論の中心に据えられている印象を受けます。

そのうち、エンティティパターンやリポジトリパターンは「第2部 モデル駆動設計の構成要素」において取り上げられています。
そして、そのナビゲーションマップには「モデル駆動設計を構成する言語」と記されているように、「エンティティ」や「リポジトリ」はモデリングと設計を行うための語彙なのです。

エンティティやリポジトリといったパターンは明快で実装しやすく、多くの現場で歓迎されていることでしょう。
しかし、パターンを実装上の構造にマッピングしようとする意識が強くなり過ぎると、それらが**どのように活かされるのか**という視点がしばしば置き去りにされてしまいます。
形式としてパターンを丁寧に当てはめることで、そのアプローチは確かにひとつの道筋を与えてくれます。
ところが、実践の中では形式的なアプローチがうまく機能しない場面に出会うことも少なくありません。

本稿では、エンティティやリポジトリといったパターンを実装のレイアウトとして形式的に当てはめていくアプローチが抱えがちな実践上の課題を振り返りながら、より現実的で柔軟な考え方――**モデリングにおける「関係性」や「役割り」の視点**から、これらのパターンの活かし方を探っていきます。

:::message
ドメイン駆動設計とは、書籍『エリック・エヴァンスのドメイン駆動設計』のまえがきによると、ドメインモデリングと設計をどのようにするかを追求しようとする哲学です。

見返し（表紙と裏表紙の内側に貼り付けられた色紙）にはこの本で述べられていることの全体像を表す図が描かれています。
この図に「ユビキタス言語」と「モデル駆動設計」が軸として据えられていることから、さらにこれらが最初に述べられるパターンであることからも、この本が対話と思考の枠組みを示そうとしている姿勢が伺えます。

この記事では単に「エンティティパターン」「リポジトリパターン」と呼ぶことにします。
「軽量」であってもそれらを「DDD」と呼ぶことを差し控えるのがよいと考えるからです。
:::

## 形式的なアプローチが直面する課題

### エンティティの肥大化

エンティティパターンを実装レイアウトの基盤にしようとしたとき、早い段階で直面するのがエンティティの肥大化です。
ドメインの理解に基づいて振る舞いをエンティティに実装していく
――その設計は一見すると見事で、誠実な試みにも思えます。
しかし、振る舞いを実装し続けることでエンティティは次第に複雑さを増し、維持と管理が難しくなっていきます。

システムが大きくなるに連れ、エンティティが利用される場面も多様化していきます。
『エリック・エヴァンスのドメイン駆動設計』の「第4章 ドメインを隔離する」にある「レイヤー化アーキテクチャ」の図4.1を見てみましょう。
ここでは、振込元になる「口座」にアプリケーションサービスから`transferTo()`が呼び出されます。
その中で、振込先になる「口座」には`credit()`が、振込元の「口座」には`debit()`が呼び出される構造です。
この例では、アプリケーションサービスとの関係における振る舞いに加えて、エンティティ同士の関係における振る舞いも存在しています。
また、将来的にはさらに他のエンティティとの関係に応じた振る舞いも加わっていくでしょう。
このように、エンティティが呼び出される関連のパターンは次第に増え、複雑化していきます。

エンティティの呼び出しグラフを図にしてみると、そこに潜む問題の深刻さが次第に浮かび上がってきます。
複数のユースケースを実現する過程で、それぞれ異なる呼び出しグラフが形成されていきます。
この呼び出し関係はエンティティの振る舞い（メソッド）として実装することになります。
この図を眺めるだけでも、呼び出しが複雑に絡み合っている様子が伝わってきます。
さらに、実際に書き上がったソースコードを見るとどうでしょう。
エンティティにはいくつものユースケースに対応するためのメソッド群が実装されています。
このメソッド群を前にして、もとの呼び出しグラフ――ユースケースごとの構造を想像できるでしょうか。

### リポジトリの形骸化


